<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MaxBits · Daily Tech Intelligence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#f5f7fa;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
    }
    body[data-theme="dark"]{
      --bg:#020617;
      --card:#020617;
      --text:#f9fafb;
      --muted:#9ca3af;
    }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .page{
      max-width:1100px;
      margin:0 auto;
      padding:24px 16px 40px;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:20px;
    }
    .brand{
      font-weight:700;
      font-size:18px;
    }
    .header-right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:6px;
    }
    .view-row{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:11px;
      letter-spacing:0.15em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .toggle{
      width:40px;
      height:22px;
      border-radius:999px;
      border:1px solid #ccc;
      padding:2px;
      cursor:pointer;
      background:#fff;
      position:relative;
    }
    body[data-theme="dark"] .toggle{ background:#020617; }
    .thumb{
      width:16px;
      height:16px;
      border-radius:50%;
      background:#020617;
      transition:.2s;
    }
    body[data-theme="dark"] .thumb{
      transform:translateX(16px);
      background:#facc15;
    }
    .exit-btn{
      font-size:11px;
      padding:4px 12px;
      border-radius:999px;
      border:1px solid #fecaca;
      background:#fee2e2;
      color:#b91c1c;
      cursor:pointer;
    }
    body[data-theme="dark"] .exit-btn{
      background:#7f1d1d;
      color:#fee2e2;
    }
    .card{
      background:var(--card);
      border-radius:14px;
      padding:16px;
      border:1px solid #e5e7eb;
    }
    iframe{
      width:100%;
      height:75vh;
      border:none;
      border-radius:12px;
    }
    .weather{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }
  </style>
</head>

<body>
<div class="page">

  <header>
    <div class="brand">MaxBits</div>

    <div class="header-right">
      <div class="view-row">
        <span>View-mode</span>
        <div class="toggle" id="theme-toggle">
          <div class="thumb"></div>
        </div>
      </div>
      <button class="exit-btn" id="exit-btn">Exit</button>
    </div>
  </header>

  <div class="card">
    <h2>Today Report</h2>
    <iframe src="reports/html/report_2025-12-12.html"></iframe>
    <div class="weather" id="weather-text">Detecting your location…</div>
  </div>

</div>

<script>
/* ---------------- PASSWORD (session) ---------------- */
(function(){
  const PASSWORD="mix";
  const KEY="maxbits-auth";
  if(!sessionStorage.getItem(KEY)){
    const p=prompt("Enter password to access MaxBits:");
    if(p!==PASSWORD){
      location.href="bye.html";
      return;
    }
    sessionStorage.setItem(KEY,"1");
  }
})();

/* ---------------- THEME TOGGLE ---------------- */
(function(){
  const root=document.body;
  const key="maxbits-theme";
  const btn=document.getElementById("theme-toggle");
  const saved=localStorage.getItem(key)||"light";
  root.setAttribute("data-theme",saved);
  btn.onclick=()=>{
    const next=root.getAttribute("data-theme")==="dark"?"light":"dark";
    root.setAttribute("data-theme",next);
    localStorage.setItem(key,next);
  };
})();

/* ---------------- EXIT ---------------- */
document.getElementById("exit-btn").onclick=()=>{
  sessionStorage.clear();
  location.href="bye.html";
};

/* ---------------- WEATHER (session geo) ---------------- */
(function(){
  const el=document.getElementById("weather-text");
  const GEO="maxbits-geo";
  function show(t){el.textContent=t;}

  function load(lat,lon){
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m&timezone=auto`)
      .then(r=>r.json())
      .then(d=>{
        const t=d?.current?.temperature_2m;
        if(typeof t==="number") show(`Your location · ${t.toFixed(1)}°C`);
        else show("Weather unavailable");
      })
      .catch(()=>show("Weather unavailable"));
  }

  try{
    const c=sessionStorage.getItem(GEO);
    if(c){
      const o=JSON.parse(c);
      load(o.lat,o.lon);
      return;
    }
  }catch(e){}

  if(!navigator.geolocation){ show("Location not available"); return; }

  navigator.geolocation.getCurrentPosition(p=>{
    const lat=p.coords.latitude.toFixed(3);
    const lon=p.coords.longitude.toFixed(3);
    sessionStorage.setItem(GEO,JSON.stringify({lat,lon}));
    load(lat,lon);
  },()=>show("Location not shared"),{timeout:5000});
})();
</script>

</body>
</html>
